(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{1241:function(t,e,n){var content=n(1243);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(104).default)("cba8df8e",content,!0,{sourceMap:!1})},1242:function(t,e,n){"use strict";n(1241)},1243:function(t,e,n){var r=n(103)(!1);r.push([t.i,"@import url(https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap);"]),r.push([t.i,".template-wrapper[data-v-2bb6d93f]{width:100%;padding:5px}#mediaFrame[data-v-2bb6d93f]{width:100%;border:none;border-radius:14px}",""]),t.exports=r},1245:function(t,e,n){"use strict";n(24),n(67);var r={props:{html:{type:String,default:null}},data:function(){return{loading:!0}},mounted:function(){document.addEventListener("keydown",this.sendKeyEvents)},created:function(){window.addEventListener("message",this.communicateWithIframe)},beforeDestroy:function(){window.removeEventListener("message",this.communicateWithIframe),document.removeEventListener("keydown",this.sendKeyEvents)},methods:{mediaFrameLoaded:function(){this.loading=!1,this.$emit("templateLoaded")},sendKeyEvents:function(t){var e=document.getElementById("mediaFrame");e&&e.contentWindow.postMessage({task:"key",key:t.key},"*")},communicateWithIframe:function(t){var data=t.data;switch(data.task){case"setHeight":document.getElementById("mediaFrame").height=data.height+"px";break;case"submit":this.$emit("submit",data.values);break;case"results":document.getElementById("mediaFrame").contentWindow.postMessage(data,"*")}}}},l=(n(1242),n(27)),component=Object(l.a)(r,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"template-wrapper"},[t.loading?n("div",[t._v("\n    Loading..\n  ")]):t._e(),t._v(" "),n("iframe",{ref:"mediaFrame",attrs:{id:"mediaFrame",srcdoc:t.html,name:"mediaFrame",sandbox:"allow-scripts allow-modals allow-downloads allow-forms allow-popups allow-pointer-lock allow-same-origin",allow:"geolocation; microphone; camera; autoplay; fullscreen",allowFullScreen:""},on:{load:t.mediaFrameLoaded}})])}),[],!1,null,"2bb6d93f",null);e.a=component.exports},1458:function(t,e,n){"use strict";n.r(e);n(86),n(50),n(106),n(107);var r=n(3),l=n(569),o=n(39),c=(n(33),n(51),n(137),n(279),n(606),n(117),n(24),n(57),n(1406),n(68),n(1412),n(1414),n(1416),n(1417),n(1418),n(1419),n(1420),n(1421),n(1422),n(1423),n(1424),n(1425),n(1426),n(1427),n(1428),n(1429),n(67),n(186),n(69),n(382),n(158),n(119),n(77),n(1430),n(280),n(605),n(607),n(185)),d=n(135);function v(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,n)}return e}function m(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?v(Object(source),!0).forEach((function(e){Object(o.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):v(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var f={middleware:["auth"],components:{TemplateMedia:n(1245).a},data:function(){return{campaignId:parseInt(this.$route.params.id),repetitions:1,newTask:{},tasks:[],tempCounter:0,taskModal:!1,previewTask:!1,placeholders:null,campaign:null,file:{name:null,content:null},error:null}},computed:m(m(m({},Object(c.c)({campaigns:function(t){return t.campaign.campaigns},campaignLoading:function(t){return t.campaign.loading}})),Object(c.b)({batchByCampaignId:"campaign/batchByCampaignId"})),{},{efxAvailable:function(){return this.$blockchain.efxAvailable+this.$blockchain.vefxAvailable},maxAmountTask:function(){return Math.floor((this.$blockchain.efxAvailable+this.$blockchain.vefxAvailable)/this.campaign.info.reward)}}),mounted:function(){this.getCampaign()},methods:{generateCsvData:function(t){var link=this.$refs.csvfiledownload,e="data:text/csv;charset=utf-8,";e+=[Object.values(t).join(","),t.map((function(t){return t+"-value-task-1"})),t.map((function(t){return t+"-value-task-2"})),t.map((function(t){return t+"-value-task-3"}))].join("\n").replace(/(^\[)|(\]$)/gm,""),console.log("TEST",e),link.href=encodeURI(e)},createTask:function(){var t=this;this.newTask.id=this.tempCounter++,this.tasks.push(this.newTask),this.newTask=this.getEmptyTask(this.placeholders),this.$nextTick((function(){t.$refs["placeholder-0"][0].focus()}))},previewModal:function(t){this.previewTask=!0,this.previewTask=this.tasks[t]},renderTemplate:function(template){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new d.Template(template,t,e).render()},postResults:function(t){var e=document.getElementById("mediaFrame");e&&e.contentWindow.postMessage({task:"results",value:t},"*")},getEmptyTask:function(t){var e={};return t.forEach((function(t){e[t]=""})),e},getPlaceholders:function(template){var t=function(t,e,n){n||(n=1);for(var r,l=[];r=e.exec(t);)l.push(r[n]);return l}(template,/\$\{\s?(\w+)\s?\|?\s?(\w*)\s?\}/g),e=Object(l.a)(new Set(t));this.placeholders=e},getCampaign:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("campaign/getCampaign",t.campaignId);case 2:t.campaign=t.campaigns.find((function(e){return e.id===t.campaignId})),t.getPlaceholders(t.campaign.info.template),t.$nextTick((function(){t.generateCsvData(t.placeholders)})),t.newTask=t.getEmptyTask(t.placeholders);case 6:case"end":return e.stop()}}),e)})))()},uploadBatch:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var content,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,content={tasks:t.tasks},e.next=4,t.$blockchain.createBatch(t.campaignId,content,t.repetitions);case 4:n=e.sent,t.$store.dispatch("transaction/addTransaction",n),t.$router.push("/campaigns/"+t.campaignId),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),t.$blockchain.handleError(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})))()},cancel:function(){this.$router.push("/campaigns/"+this.campaignId)},uploadFile:function(t){var e=this;if(this.file={name:null,content:null},this.error=null,console.log(t),t.target.files[0]){this.file.name=t.target.files[0].name;var n=new FileReader;n.onload=function(t){e.file.content=e.csvToJson(t.target.result),e.file.content.forEach((function(element){e.newTask=element,e.createTask();var t=!1;e.placeholders.forEach((function(e){element[e]&&(t=!0)})),t||(e.error="Placeholder not found in CSV")}))},n.readAsText(t.target.files[0])}else this.error="Could not find file",this.file=null},csvToJson:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:'"',r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:",",c=new RegExp("\\s*(".concat(n,")?(.*?)\\1\\s*(?:").concat(r,"|$)"),"gs"),d=function(t){return Object(l.a)(t.matchAll(c)).map((function(t){return t[2]})).filter((function(t,i,a){return i<a.length-1}))},v=t.split("\n"),f=e||d(v.splice(0,1)[0]);return v.map((function(line){return d(line).reduce((function(t,e,i){return m(m({},t),{},Object(o.a)({},f[i]||"extra_".concat(i),e.length>0?Number(e)||e:null))}),{})}))}}},h=f,_=n(27),component=Object(_.a)(h,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("section",{staticClass:"section is-max-widescreen"},[n("div",{staticClass:"container"},[n("nav",{staticClass:"breadcrumb",attrs:{"aria-label":"breadcrumbs"}},[n("ul",[n("li",[n("nuxt-link",{attrs:{to:"/"}},[t._v("\n            All Campaigns\n          ")])],1),t._v(" "),n("li",[n("nuxt-link",{attrs:{to:"/campaigns/"+t.campaignId}},[t._v("\n            Campaign "+t._s(t.campaignId)+"\n          ")])],1),t._v(" "),t._m(0)])]),t._v(" "),n("div",[n("div",{staticClass:"title"},[t._v("\n        Tasks\n      ")]),t._v(" "),n("div"),t._v(" "),n("form",[n("div",{staticClass:"field"},[n("div",[n("table",{staticClass:"table mx-auto"},[n("thead",[n("tr",[t.tasks.length?n("th",[t._v("Index")]):t._e(),t._v(" "),t._l(t.placeholders,(function(e){return n("th",{key:e,staticClass:"task-placeholder-value"},[t._v("\n                    "+t._s(e)+"\n                  ")])})),t._v(" "),t.tasks.length?n("th",[t._v("Remove")]):t._e(),t._v(" "),t.tasks.length?n("th",[t._v("Preview")]):t._e()],2)]),t._v(" "),n("tbody",[t._l(t.tasks,(function(e,r){return n("tr",{key:e.id},[n("td",[t._v(t._s(r+1))]),t._v(" "),t._l(t.placeholders,(function(r){return n("td",{key:r,staticClass:"task-placeholder-value"},[t._v("\n                      "+t._s(e[r])+"\n                  ")])})),t._v(" "),n("td",[n("button",{staticClass:"button is-danger is-outlined is-small is-rounded",on:{click:function(e){return e.preventDefault(),t.tasks.splice(r,1)}}},[n("font-awesome-icon",{attrs:{icon:"fa-solid fa-trash-can"}})],1)]),t._v(" "),n("td",[n("button",{staticClass:"button is-info is-outlined is-small is-rounded",on:{click:function(e){return e.preventDefault(),t.previewModal(r)}}},[n("font-awesome-icon",{attrs:{icon:"fa-solid fa-magnifying-glass"}})],1)])],2)})),t._v(" "),n("tr",[t.tasks.length?n("td"):t._e(),t._v(" "),t._l(t.placeholders,(function(e,r){return n("td",{key:e,staticClass:"task-placeholder-value"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.newTask[e],expression:"newTask[placeholder]"}],ref:"placeholder-"+r,refInFor:!0,staticClass:"input is-info task-placeholder-value",attrs:{type:"text",placeholder:"..."},domProps:{value:t.newTask[e]},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),t.createTask.apply(null,arguments))},input:function(n){n.target.composing||t.$set(t.newTask,e,n.target.value)}}})])})),t._v(" "),t.tasks.length?n("td"):t._e()],2)],2),t._v(" "),n("tfoot")]),t._v(" "),t.tasks.length?t._e():n("div",{staticClass:"has-text-centered"},[n("h1",[t._v("\n                No tasks...\n              ")])]),t._v(" "),n("div",{staticClass:"control has-text-centered"},[n("button",{staticClass:"button is-primary",on:{click:function(e){return e.preventDefault(),t.createTask.apply(null,arguments)}}},[t._v("\n                Create Task\n              ")]),t._v(" "),n("br"),t._v(" "),n("br"),t._v(" "),n("nuxt-link",{staticClass:"button is-primary",attrs:{to:"/deposit"}},[t._v("Deposit")])],1)]),t._v(" "),n("hr"),t._v(" "),t.tasks.length?n("div",[n("div",{staticClass:"columns"},[n("div",{staticClass:"column"},[n("h2",[t._v("Batch Cost")]),t._v(" "),n("strong",[t._v(t._s(t.campaign.info.reward*t.tasks.length)+" EFX")])]),t._v(" "),n("div",{staticClass:"column"},[n("h2",[t._v("Available Balance")]),t._v(" "),n("strong",[t._v(t._s(t.efxAvailable))])]),t._v(" "),n("div",{staticClass:"column"},[n("h2",[t._v("Batch Tasks possible")]),t._v(" "),n("strong",[t._v(t._s(t.maxAmountTask))])])])]):t._e(),t._v(" "),n("br"),t._v(" "),n("h2",{staticClass:"subtitle is-5 mb-3"},[t._v("\n            Import tasks\n          ")]),t._v(" "),n("div",{staticClass:"file has-name"},[n("label",{staticClass:"file-label"},[n("input",{staticClass:"file-input",attrs:{type:"file",name:"csvtasks"},on:{change:t.uploadFile}}),t._v(" "),t._m(1),t._v(" "),t.file&&t.file.name?n("span",{staticClass:"file-name"},[t._v("\n                "+t._s(t.file.name)+"\n              ")]):t._e()])]),t._v(" "),t.error?n("p",{staticClass:"has-text-danger"},[t._v("\n            "+t._s(t.error)+"\n          ")]):t._e(),t._v(" "),n("br"),t._v(" "),n("div",[n("a",{ref:"csvfiledownload",attrs:{id:"downloadlink",href:"",download:"tasks_example"+t.campaignId+".csv"}},[t._v("download example csv")])])])]),t._v(" "),n("form",{on:{submit:function(e){return e.preventDefault(),t.uploadBatch.apply(null,arguments)}}},[n("div",{staticClass:"field"},[n("label",{staticClass:"label"},[t._v("Repetitions")]),t._v(" "),n("div",{staticClass:"control"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.repetitions,expression:"repetitions"}],staticClass:"input",attrs:{type:"number",min:"0",required:""},domProps:{value:t.repetitions},on:{input:function(e){e.target.composing||(t.repetitions=e.target.value)}}})])]),t._v(" "),n("div",{staticClass:"field is-grouped"},[n("div",{staticClass:"control"},[n("button",{staticClass:"button is-link",attrs:{type:"submit",disabled:!t.tasks.length||t.tasks.length>=t.maxAmountTask}},[t._v("\n              Submit\n            ")])]),t._v(" "),n("div",{staticClass:"control"},[n("button",{staticClass:"button is-link is-light",on:{click:function(e){return e.preventDefault(),t.cancel.apply(null,arguments)}}},[t._v("\n              Cancel\n            ")])])])])]),t._v(" "),n("div",{staticClass:"modal",class:{"is-active":t.previewTask}},[n("div",{staticClass:"modal-background",on:{click:function(e){t.previewTask=!1}}}),t._v(" "),n("div",{staticClass:"modal-content",staticStyle:{"background-color":"#fff",padding:"10px"}},[t.campaign&&t.campaign.info&&t.previewTask?n("template-media",{attrs:{html:t.renderTemplate(t.campaign.info.template||"No template found..",t.previewTask)},on:{templateLoaded:function(e){return t.postResults(t.previewTask.results)}}}):t._e()],1),t._v(" "),n("button",{staticClass:"modal-close is-large",attrs:{"aria-label":"close"},on:{click:function(e){t.previewTask=!1}}})])])])}),[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("li",{staticClass:"is-active"},[n("a",{attrs:{"aria-current":"page"}},[t._v("\n            New Batch\n          ")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("span",{staticClass:"file-cta"},[n("span",{staticClass:"file-label"},[t._v("\n                  Choose a .csv file…\n                ")])])}],!1,null,"7f333c20",null);e.default=component.exports}}]);