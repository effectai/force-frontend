(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{1234:function(t,e,n){var content=n(1242);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(102).default)("49463a7a",content,!0,{sourceMap:!1})},1241:function(t,e,n){"use strict";n(1234)},1242:function(t,e,n){var r=n(101)(!1);r.push([t.i,"@import url(https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap);"]),r.push([t.i,".template-wrapper[data-v-225947fa]{width:100%;padding:5px}#mediaFrame[data-v-225947fa]{width:100%;border:none;border-radius:14px}",""]),t.exports=r},1246:function(t,e,n){"use strict";n(24),n(66);var r={props:{html:{type:String,default:null}},data:function(){return{loading:!0}},mounted:function(){document.addEventListener("keydown",this.sendKeyEvents)},created:function(){window.addEventListener("message",this.communicateWithIframe)},beforeDestroy:function(){window.removeEventListener("message",this.communicateWithIframe),document.removeEventListener("keydown",this.sendKeyEvents)},methods:{mediaFrameLoaded:function(){this.loading=!1,this.$emit("templateLoaded")},sendKeyEvents:function(t){var e=document.getElementById("mediaFrame");e&&e.contentWindow.postMessage({task:"key",key:t.key},"*")},communicateWithIframe:function(t){var data=t.data;switch(data.task){case"setHeight":document.getElementById("mediaFrame").height=data.height+"px";break;case"submit":this.$emit("submit",data.values)}}}},c=(n(1241),n(32)),component=Object(c.a)(r,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"template-wrapper"},[t.loading?n("div",[t._v("\n    Loading..\n  ")]):t._e(),t._v(" "),n("iframe",{ref:"mediaFrame",attrs:{id:"mediaFrame",srcdoc:t.html,name:"mediaFrame",sandbox:"allow-scripts allow-modals allow-downloads allow-forms allow-popups allow-pointer-lock allow-same-origin",allow:"geolocation; microphone; camera; autoplay; fullscreen",allowFullScreen:""},on:{load:t.mediaFrameLoaded}})])}),[],!1,null,"225947fa",null);e.a=component.exports},1254:function(t,e,n){"use strict";n(85),n(24),n(77),n(88),n(67),n(51),n(50),n(86),n(89),n(66);var r=n(4);n(40);function c(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return o(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,l=!0,d=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return l=t.done,t},e:function(t){d=!0,c=t},f:function(){try{l||null==n.return||n.return()}finally{if(d)throw c}}}}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var l=n(590),d={props:{batch:{type:Object,default:null}},data:function(){return{loading:!1,error:null}},mounted:function(){this.makeReservation()},methods:{makeReservation:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,c,o,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.loading=!0,e.next=4,t.$blockchain.getReservations();case 4:return n=e.sent,e.next=7,t.getReservationForUser(n);case 7:if(c=e.sent){e.next=15;break}return e.next=11,t.$blockchain.reserveTask(t.batch.id,t.batch.campaign_id,t.batch.tasks_done,t.batch.tasks);case 11:return o=e.sent,t.$store.dispatch("transaction/addTransaction",o),e.next=15,l(Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$blockchain.getReservations();case 2:return n=e.sent,e.next=5,t.getReservationForUser(n);case 5:if(c=e.sent){e.next=8;break}throw new Error("Reservation not found");case 8:case"end":return e.stop()}}),e)}))),{retries:5,onRetry:function(t,e){console.log("attempt",e,t)}});case 15:if(!c){e.next=22;break}return e.next=18,t.$blockchain.getTaskIndexFromLeaf(t.batch.campaign_id,t.batch.id,c.leaf_hash,t.batch.tasks);case 18:d=e.sent,t.$router.push("/campaigns/"+t.batch.campaign_id+"/"+t.batch.batch_id+"/"+d+"?submissionId="+c.id),e.next=23;break;case 22:t.$router.push("/campaigns/"+t.batch.campaign_id+"/"+t.batch.batch_id);case 23:t.loading=!1,e.next=30;break;case 26:e.prev=26,e.t0=e.catch(0),t.loading=!1,t.$blockchain.handleError(e.t0);case 30:case"end":return e.stop()}}),e,null,[[0,26]])})))()},getReservationForUser:function(t){var e,n,r=c(t.rows);try{for(r.s();!(n=r.n()).done;){var o=n.value;if(!(o.account_id!==this.$auth.user.vAccountRows[0].id||parseInt(this.batch.batch_id)!==parseInt(o.batch_id)||o.data&&o.data.length)){e=o;break}}}catch(t){r.e(t)}finally{r.f()}return e}}},m=n(32),component=Object(m.a)(d,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("span",[t.loading?n("div",{staticClass:"loader-wrapper is-active"},[n("div",{staticClass:"loader is-loading"}),t._v(" "),n("br"),t._v("Making reservation...\n  ")]):t._e()])}),[],!1,null,null,null);e.a=component.exports},1268:function(t,e,n){"use strict";var r={props:{message:{type:String,default:null},title:{type:String,default:null}},data:function(){return{messageTitle:this.title,messageContent:this.message}}},c=n(32),component=Object(c.a)(r,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"modal",class:{"is-active":t.messageContent}},[n("div",{staticClass:"modal-background",on:{click:function(e){t.messageContent=null}}}),t._v(" "),n("div",{staticClass:"modal-content p-5 has-background-success has-radius has-text-white"},[n("h3",{staticClass:"subtitle has-text-white is-5"},[t._v(t._s(t.messageTitle))]),t._v(" "),n("p",[t._v(t._s(t.messageContent))]),t._v(" "),n("button",{staticClass:"modal-close is-large",attrs:{"aria-label":"close"},on:{click:function(e){t.messageContent=null}}}),t._v(" "),n("div",{staticClass:"has-text-right"},[n("button",{staticClass:"button",on:{click:function(e){t.messageContent=null}}},[t._v("OK")])])])])}),[],!1,null,null,null);e.a=component.exports},1392:function(t,e,n){"use strict";n.r(e);n(104),n(50),n(74),n(114),n(75),n(115);var r=n(4),c=n(43),o=(n(40),n(216),n(24),n(184)),l=n(157),d=n(1246),m=n(1254),h=n(1268);function f(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,n)}return e}var v={components:{"template-media":d.a,"reserve-task":m.a,"success-modal":h.a},middleware:["auth"],data:function(){return{campaignId:parseInt(this.$route.params.id),batchId:parseInt(this.$route.params.batch),taskIndex:parseInt(this.$route.params.task),submissionId:parseInt(this.$route.query.submissionId),campaign:void 0,batch:void 0,task:void 0,reserveNextTask:!1,loading:!1,successMessage:null,successTitle:null}},computed:function(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?f(Object(source),!0).forEach((function(e){Object(c.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):f(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}({},Object(o.c)({batches:function(t){return t.campaign.batches},campaigns:function(t){return t.campaign.campaigns},campaignLoading:function(t){return t.campaign.loading},batchLoading:function(t){return t.campaign.loadingBatch}})),created:function(){this.getBatch(),this.getCampaign()},methods:{renderTemplate:function(template){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new l.Template(template,t,e).render()},getBatch:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("campaign/getBatch",{batchId:t.batchId});case 2:t.batch=t.batches.find((function(b){return b.batch_id===t.batchId})),t.task=t.batch.tasks[t.taskIndex];case 4:case"end":return e.stop()}}),e)})))()},getCampaign:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("campaign/getCampaign",t.campaignId);case 2:t.campaign=t.campaigns.find((function(e){return e.id===t.campaignId}));case 3:case"end":return e.stop()}}),e)})))()},submitTask:function(t){var e=this;return Object(r.a)(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,e.loading=!0,e.reserveNextTask=!1,n.next=5,e.$blockchain.submitTask(e.batch.batch_id,e.submissionId,JSON.stringify(t));case 5:return r=n.sent,e.successTitle="Task submitted successfully",e.successMessage="Waiting for transaction to complete before continuing",n.next=10,e.$blockchain.waitForTransaction(r.transaction_id);case 10:return e.$store.dispatch("transaction/addTransaction",r),e.loading=!1,n.next=14,e.getBatch();case 14:e.batch.tasks_done===e.batch.num_tasks?e.$router.push("/campaigns/"+e.batch.campaign_id+"/"+e.batch.batch_id+"?batchCompleted=1"):e.reserveNextTask=!0,n.next=20;break;case 17:throw n.prev=17,n.t0=n.catch(0),new Error(n.t0);case 20:case"end":return n.stop()}}),n,null,[[0,17]])})))()}}},w=v,k=n(32),component=Object(k.a)(w,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("section",{staticClass:"section is-max-widescreen"},[n("div",{staticClass:"container"},[t.loading?n("div",{staticClass:"loader-wrapper is-active"},[n("div",{staticClass:"loader is-loading"}),t._v(" "),n("br"),t._v("Waiting for the transaction to complete...\n    ")]):t._e(),t._v(" "),n("h2",{staticClass:"subtitle mt-5"},[t._v("\n      Task\n    ")]),t._v(" "),t.campaign&&t.campaign.info?n("template-media",{attrs:{html:t.renderTemplate(t.campaign.info.template||"No template found..",t.task)},on:{submit:t.submitTask}}):t._e(),t._v(" "),t.successMessage?n("success-modal",{attrs:{message:t.successMessage,title:t.successTitle}}):t._e(),t._v(" "),t.reserveNextTask?n("reserve-task",{attrs:{batch:t.batch}}):t._e()],1)])}),[],!1,null,null,null);e.default=component.exports}}]);