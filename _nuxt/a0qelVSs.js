import{g as h,u as I,o as e,c as o,a,t as r,k as t,_ as b,E as O,r as L,M as F,O as Q,I as U,F as w,w as C,b as y,P as Y,d as R,l as T,Q as G,S as P,T as V,U as K,i as W,V as j,p as S,e as B,G as x}from"./Df8CzY1l.js";import{_ as z}from"./CNiFXiVx.js";import{_ as H}from"./DWzN02_V.js";import{f as J}from"./VZpoIE_P.js";const X={class:"tasks-available-banner"},Z=h({__name:"TasksAvailableBanner",setup(i){const{useCampaigns:c}=I(),{totalTasksAvailable:d,data:_}=c({calculateAvailableTasks:!0});return(p,s)=>(e(),o("div",X,[a("p",null,"You have "+r(t(d))+" new tasks available!",1)]))}}),aa=b(Z,[["__scopeId","data-v-c0a542cf"]]),sa={class:"reservation-container"},na={class:"started-on"},ea={class:"card-title"},ta=h({__name:"ReservationCard",props:{id:{},campaignId:{},reservedOn:{},taskIdx:{}},setup(i){const c=i,{useCampaign:d}=I(),{mutate:_,loading:p}=O(),s=L(!1),n=L(null),{data:k}=d(c.campaignId,s),u=F(()=>n.value??k.value),m=Q(),g=async()=>{const l=m.getQueriesData({queryKey:["campaigns"]});if(l){const v=l[0][1].find(A=>A.id===c.campaignId);return v?n.value=v:null}},f=l=>l.reservations_done/l.total_tasks>1?100:l.reservations_done/l.total_tasks*100;return U(async()=>{g()||(s.value=!0)}),(l,$)=>{const v=G,A=z,M=H;return t(u)?(e(),w(M,{key:0,to:`/campaign/${t(u).id}`,class:"card reservation"},{default:C(()=>{var N,q;return[a("div",sa,[a("div",null,[a("span",na," started "+r(("formatDateStringToTimeAgo"in l?l.formatDateStringToTimeAgo:t(J))(c.reservedOn)),1),a("h2",ea,[a("span",null,r((N=t(u).info)==null?void 0:N.title),1)]),a("p",null,r((q=t(u).info)==null?void 0:q.description),1)]),y(v,{reverse:!1,progress:f(t(u))},null,8,["progress"]),y(A,{"is-loading":t(p),class:"button",onClick:$[0]||($[0]=Y(Ua=>t(_)(l.campaignId),["prevent"]))},{default:C(()=>[R(" Continue to earn "+r(t(u).reward.quantity),1)]),_:1},8,["is-loading"])])]}),_:1},8,["to"])):T("",!0)}}}),oa=b(ta,[["__scopeId","data-v-f76ea93a"]]),ia={class:"reservation-list"},ca={key:0},ra={key:1,class:"reservation-container"},la=h({__name:"ReservationsList",props:{loading:{type:Boolean},reservations:{},max:{}},setup(i){const c=i,d=F(()=>{var _;return(_=c.reservations)==null?void 0:_.toSorted((p,s)=>new Date(s.reserved_on).getTime()-new Date(p.reserved_on).getTime()).slice(0,c.max)});return(_,p)=>{const s=oa;return e(),o("div",ia,[_.loading?(e(),o("div",ca," Loading.. ")):_.reservations?(e(),o("div",ra,[(e(!0),o(P,null,V(t(d),n=>(e(),w(s,{id:n.id,key:n.id,"task-idx":n.task_idx,"reserved-on":n.reserved_on,"campaign-id":n.campaign_id},null,8,["id","task-idx","reserved-on","campaign-id"]))),128))])):T("",!0)])}}}),da={class:"avatar"},_a=a("img",{src:"/img/default-avatar.webp",alt:"Rounded avatar"},null,-1),pa=[_a],ua=h({__name:"UserAvatar",props:{id:{}},setup(i){return(c,d)=>(e(),o("div",da,pa))}}),D=i=>(S("data-v-69795f98"),i=i(),B(),i),ma={class:"campaign-user"},ga={key:0,class:"campaign-title"},va={key:1},ha=D(()=>a("br",null,null,-1)),ka=D(()=>a("div",null,r("No description"),-1)),fa={key:0},$a={key:1},Ta={key:0},ya=D(()=>a("br",null,null,-1)),ba={key:0},Ca={key:1},Ia={class:"campaign-quantity"},wa=h({__name:"CampaignTableRow",props:{campaign:{},accTaskIndex:{}},async setup(i){let c,d;const _=([c,d]=K(()=>j()),c=await c,d(),c),p=W();return(s,n)=>{var u,m;const k=ua;return e(),o("tr",{onClick:n[0]||(n[0]=g=>t(p).push(`/campaign/${s.campaign.id}`))},[a("td",null,[a("div",ma,[y(k,{id:s.campaign.owner.at(1)},null,8,["id"]),a("span",null,r(s.campaign.owner.at(1)),1)])]),s.campaign&&s.campaign?(e(),o("td",ga,[a("h4",null,r((u=s.campaign.info)==null?void 0:u.title),1),a("span",null,r((m=s.campaign.info)==null?void 0:m.description),1)])):(e(),o("td",va,[R(r("No title")+" "),ha,ka])),a("td",null,[s.campaign.campaignTasksAvailable===null?(e(),o("span",fa,r(s.campaign.total_tasks)+" tasks ",1)):(e(),o("span",$a,[R(r(s.campaign.campaignTasksAvailable)+"/"+r(s.campaign.total_tasks)+" left ",1),s.campaign.campaignTasksAvailable>s.campaign.batchTaskAvailable?(e(),o("small",Ta,[ya,s.campaign.batchTaskAvailable?(e(),o("span",ba,r(s.campaign.batchTaskAvailable)+" tasks in current batch ",1)):(e(),o("span",Ca," Wait for current batch to finish "))])):T("",!0)]))]),a("td",Ia,[a("h4",null,r(s.campaign.reward.quantity),1),a("span",null," $"+r((parseFloat(s.campaign.reward.quantity.split(" ")[0])*t(_)).toFixed(2))+" per task ",1)])])}}}),Aa=b(wa,[["__scopeId","data-v-69795f98"]]),La=i=>(S("data-v-c49f648a"),i=i(),B(),i),Ra={class:"campaign-list"},Sa={key:0},Ba={key:1},Da={key:2,class:"table-container"},Na=La(()=>a("thead",null,[a("tr",null,[a("th",null,"Dataset"),a("th",null,"Title"),a("th",null,"Tasks"),a("th",null,"Reward Per Task")])],-1)),qa=h({__name:"CampaignList",props:{campaigns:{},loading:{type:Boolean}},setup(i){const{useAccTaskIdx:c}=I(),{data:d,isLoading:_}=c(),p=L(0),s=n=>{p.value+=n};return(n,k)=>{const u=Aa;return e(),o("div",Ra,[n.loading?(e(),o("div",Sa,[x(n.$slots,"loading",{},void 0,!0)])):n.campaigns&&n.campaigns.length===0?(e(),o("div",Ba,[x(n.$slots,"empty",{},void 0,!0)])):n.campaigns&&n.campaigns.length>0?(e(),o("div",Da,[a("table",null,[Na,a("tbody",null,[(e(!0),o(P,null,V(n.campaigns,m=>{var g,f;return e(),w(u,{key:m.id,campaign:m,accTaskIndex:(f=(g=t(d))==null?void 0:g.find(l=>l.campaign_id===m.id))==null?void 0:f.value,onTasksCounted:s},null,8,["campaign","accTaskIndex"])}),128))])])])):T("",!0)])}}}),xa=b(qa,[["__scopeId","data-v-c49f648a"]]),E=i=>(S("data-v-4dcfba47"),i=i(),B(),i),Fa={class:"container"},Pa={key:0},Va={class:"title mb-0"},Ea={class:"title mb-0"},Ma=E(()=>a("div",null,"No campaigns found.",-1)),Oa=E(()=>a("div",null,"Loading campaigns",-1)),Qa=h({__name:"index",setup(i){const{useCampaigns:c,useReservations:d,isLoggedIn:_}=I(),{data:p,isLoading:s}=c({calculateAvailableTasks:!0}),{data:n,isLoading:k}=d();return(u,m)=>{var $,v;const g=aa,f=la,l=xa;return e(),o("div",Fa,[y(g),t(_)?(e(),o("div",Pa,[a("h2",Va," Your active Datasets ("+r(($=t(n))==null?void 0:$.length)+") ",1),t(p)?(e(),w(f,{key:0,max:3,loading:t(k),reservations:t(n)},null,8,["loading","reservations"])):T("",!0)])):T("",!0),a("div",null,[a("h2",Ea," All Datasets ("+r((v=t(p))==null?void 0:v.length)+") ",1),y(l,{loading:t(s),campaigns:t(p)},{empty:C(()=>[Ma]),loading:C(()=>[Oa]),_:1},8,["loading","campaigns"])])])}}}),ja=b(Qa,[["__scopeId","data-v-4dcfba47"]]);export{ja as default};
