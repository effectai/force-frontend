import{g as C,u as D,r as R,L as E,N as K,H as W,k as s,o as t,E as N,w as S,a,t as l,b as B,O as j,d as P,l as w,P as z,_ as q,c as o,Q as V,S as Y,T as G,i as J,U as X,p as O,e as Q,F as M}from"./BQJH5Vms.js";import{_ as Z}from"./BxP-EYTJ.js";import{_ as aa}from"./CkSJj9Ae.js";import{u as sa}from"./CqjtysJN.js";import{f as ta}from"./VZpoIE_P.js";const ea={class:"reservation-container"},na={class:"started-on"},oa={class:"card-title"},ia=C({__name:"ReservationCard",props:{id:{},campaignId:{},reservedOn:{},taskIdx:{}},setup(n){const d=n,{useCampaign:_}=D(),{mutate:p,loading:u}=sa(),m=R(!1),e=R(null),{data:I}=_(d.campaignId,m),g=E(()=>e.value??I.value),h=K(),f=async()=>{const i=h.getQueriesData({queryKey:["campaigns"]});if(i){const A=i[0][1].find(x=>x.id===d.campaignId);return A?e.value=A:null}},r=i=>i.reservations_done/i.total_tasks>1?100:i.reservations_done/i.total_tasks*100;return W(async()=>{f()||(m.value=!0)}),(i,b)=>{const A=z,x=Z,v=aa;return s(g)?(t(),N(v,{key:0,to:`/campaign/${s(g).id}`,class:"card reservation"},{default:S(()=>{var c,k;return[a("div",ea,[a("div",null,[a("span",na," started "+l(("formatDateStringToTimeAgo"in i?i.formatDateStringToTimeAgo:s(ta))(d.reservedOn)),1),a("h2",oa,[a("span",null,l((c=s(g).info)==null?void 0:c.title),1)]),a("p",null,l((k=s(g).info)==null?void 0:k.description),1)]),B(A,{reverse:!1,progress:r(s(g))},null,8,["progress"]),B(x,{"is-loading":s(u),class:"button",onClick:b[0]||(b[0]=j(T=>s(p)(i.campaignId),["prevent"]))},{default:S(()=>[P(" Continue to earn "+l(s(g).reward.quantity),1)]),_:1},8,["is-loading"])])]}),_:1},8,["to"])):w("",!0)}}}),ca=q(ia,[["__scopeId","data-v-75d181fa"]]),ra={class:"reservation-list"},la={key:0},da={key:1,class:"reservation-container"},_a=C({__name:"ReservationsList",props:{loading:{type:Boolean},reservations:{},max:{}},setup(n){const d=n,_=E(()=>{var p;return(p=d.reservations)==null?void 0:p.toSorted((u,m)=>new Date(m.reserved_on).getTime()-new Date(u.reserved_on).getTime()).slice(0,d.max)});return(p,u)=>{const m=ca;return t(),o("div",ra,[p.loading?(t(),o("div",la," Loading.. ")):p.reservations?(t(),o("div",da,[(t(!0),o(V,null,Y(s(_),e=>(t(),N(m,{id:e.id,key:e.id,"task-idx":e.task_idx,"reserved-on":e.reserved_on,"campaign-id":e.campaign_id},null,8,["id","task-idx","reserved-on","campaign-id"]))),128))])):w("",!0)])}}}),pa={class:"avatar"},ua=["src"],ma=C({__name:"UserAvatar",props:{id:{}},setup(n){return(d,_)=>(t(),o("div",pa,[a("img",{src:"/img/default-avatar.webp",alt:"Rounded avatar"},null,8,ua)]))}}),U=n=>(O("data-v-67f59bd7"),n=n(),Q(),n),ga={class:"campaign-user"},va={key:0,class:"campaign-title"},ka={key:1},ha=U(()=>a("br",null,null,-1)),fa=U(()=>a("div",null,l("No description"),-1)),ba={key:0},Ta={key:1},$a={key:0},ya=U(()=>a("br",null,null,-1)),Ca={key:0},Ia={key:1},Aa={class:"campaign-quantity"},wa=C({__name:"CampaignTableRow",props:{campaign:{},accTaskIndex:{}},emits:["tasks-counted"],async setup(n,{emit:d}){let _,p;const{useReservations:u,useReservationsCampaign:m,isLoggedIn:e,useBatch:I,vAccount:g}=D();u();const h=d,f=([_,p]=G(()=>X()),_=await _,p(),_),r=n,i=R(!1),{data:b}=I(r.campaign.active_batch,i),{data:A}=m(R(r.campaign.id)),x=J(),v=E(()=>{var L,F;let c=r.campaign.total_tasks-r.campaign.reservations_done,k=c,T=r.campaign.reservations_done-1;const $=(L=A.value)==null?void 0:L.filter(y=>y.batch_id==r.campaign.active_batch);if(e.value&&(c||$!=null&&$.length)){if(i.value=!0,!b.value)return{campaignTasksAvailable:null,batchTaskAvailable:null};const y=r.accTaskIndex>=b.value.start_task_idx;y&&r.accTaskIndex>T&&(T=r.accTaskIndex),k=b.value.start_task_idx+b.value.num_tasks-1-T,y&&(c-=T-(r.campaign.reservations_done-1))}if($)for(const y of $)(Date.now()>y.reserved_on+r.campaign.max_task_time||y.account_id==((F=g.value)==null?void 0:F.id))&&y.task_idx<=T&&(k++,c++);return{campaignTasksAvailable:c,batchTaskAvailable:k}});return h("tasks-counted",v.value.campaignTasksAvailable),(c,k)=>{var $,L;const T=ma;return t(),o("tr",{onClick:k[0]||(k[0]=F=>s(x).push(`/campaign/${c.campaign.id}`))},[a("td",null,[a("div",ga,[B(T,{id:c.campaign.owner.at(1)},null,8,["id"]),a("span",null,l(c.campaign.owner.at(1)),1)])]),c.campaign&&c.campaign?(t(),o("td",va,[a("h4",null,l(($=c.campaign.info)==null?void 0:$.title),1),a("span",null,l((L=c.campaign.info)==null?void 0:L.description),1)])):(t(),o("td",ka,[P(l("No title")+" "),ha,fa])),a("td",null,[s(v).campaignTasksAvailable===null?(t(),o("span",ba,l(c.campaign.total_tasks)+" tasks ",1)):(t(),o("span",Ta,[P(l(s(v).campaignTasksAvailable)+"/"+l(c.campaign.total_tasks)+" left ",1),s(v).campaignTasksAvailable>s(v).batchTaskAvailable?(t(),o("small",$a,[ya,s(v).batchTaskAvailable?(t(),o("span",Ca,l(s(v).batchTaskAvailable)+" tasks in current batch ",1)):(t(),o("span",Ia," Wait for current batch to finish "))])):w("",!0)]))]),a("td",Aa,[a("h4",null,l(c.campaign.reward.quantity),1),a("span",null," $"+l((parseFloat(c.campaign.reward.quantity.split(" ")[0])*s(f)).toFixed(2))+" per task ",1)])])}}}),xa=q(wa,[["__scopeId","data-v-67f59bd7"]]),La=n=>(O("data-v-6c5bf637"),n=n(),Q(),n),Ra={class:"tasks-available-banner"},Ba=La(()=>a("button",{class:"button"},"View tasks",-1)),Sa=C({__name:"TasksAvailableBanner",props:{totalTasks:{}},setup(n){return(d,_)=>(t(),o("div",Ra,[a("p",null,"You have "+l(d.totalTasks)+" new tasks available!",1),Ba]))}}),Da=q(Sa,[["__scopeId","data-v-6c5bf637"]]),H=n=>(O("data-v-d7b67637"),n=n(),Q(),n),Na=H(()=>a("h2",{class:"title mb-0"}," All Datasets ",-1)),qa={class:"campaign-list"},Fa={key:0},Pa={key:1},Va={key:2,class:"table-container"},Ea=H(()=>a("thead",null,[a("tr",null,[a("th",null,"Dataset"),a("th",null,"Title"),a("th",null,"Tasks"),a("th",null,"Reward Per Task")])],-1)),Oa=C({__name:"CampaignList",props:{campaigns:{},loading:{type:Boolean}},setup(n){const{useAccTaskIdx:d}=D(),{data:_,isLoading:p}=d(),u=R(0),m=e=>{u.value+=e};return(e,I)=>{const g=xa;return t(),o(V,null,[B(Da,{totalTasks:s(u)},null,8,["totalTasks"]),Na,a("div",qa,[e.loading?(t(),o("div",Fa,[M(e.$slots,"loading",{},void 0,!0)])):e.campaigns&&e.campaigns.length===0?(t(),o("div",Pa,[M(e.$slots,"empty",{},void 0,!0)])):e.campaigns&&e.campaigns.length>0?(t(),o("div",Va,[a("table",null,[Ea,a("tbody",null,[(t(!0),o(V,null,Y(e.campaigns,h=>{var f,r;return t(),N(g,{key:h.id,campaign:h,accTaskIndex:(r=(f=s(_))==null?void 0:f.find(i=>i.campaign_id===h.id))==null?void 0:r.value,onTasksCounted:m},null,8,["campaign","accTaskIndex"])}),128))])])])):w("",!0)])],64)}}}),Qa=q(Oa,[["__scopeId","data-v-d7b67637"]]),Ua={class:"container"},Ma={key:0},Ya={class:"title mb-0"},Ha=a("div",null,"No campaigns found.",-1),Ka=a("div",null,"Loading campaigns",-1),Xa=C({__name:"index",setup(n){const{useCampaigns:d,useReservations:_,isLoggedIn:p}=D(),{data:u,isLoading:m}=d(),{data:e,isLoading:I}=_();return(g,h)=>{var i;const f=_a,r=Qa;return t(),o("div",Ua,[s(p)?(t(),o("div",Ma,[a("h2",Ya," Your active Datasets ("+l((i=s(e))==null?void 0:i.length)+") ",1),s(u)?(t(),N(f,{key:0,max:3,loading:s(I),reservations:s(e)},null,8,["loading","reservations"])):w("",!0)])):w("",!0),a("div",null,[B(r,{loading:s(m),campaigns:s(u)},{empty:S(()=>[Ha]),loading:S(()=>[Ka]),_:1},8,["loading","campaigns"])])])}}});export{Xa as default};
