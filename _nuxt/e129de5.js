(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{1256:function(e,t,n){var content=n(1268);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(58).default)("2ac9a1b4",content,!0,{sourceMap:!1})},1259:function(e,t,n){"use strict";n(25),n(69);var r={props:{html:{type:String,default:null}},data:function(){return{alternativeFrontendUrl:"https://effectai.github.io/force-frontend-new",loading:!0}},watch:{html:function(e){document.getElementById("mediaFrame").contentWindow.postMessage({task:"template",value:e},"*")}},mounted:function(){document.addEventListener("keydown",this.sendKeyEvents)},created:function(){window.addEventListener("message",this.communicateWithIframe)},beforeDestroy:function(){window.removeEventListener("message",this.communicateWithIframe),document.removeEventListener("keydown",this.sendKeyEvents)},methods:{mediaFrameLoaded:function(){this.loading=!1,document.getElementById("mediaFrame").contentWindow.postMessage({task:"template",value:this.html},"*"),this.$emit("templateLoaded")},sendKeyEvents:function(e){var t=document.getElementById("mediaFrame");t&&t.contentWindow.postMessage({task:"key",key:e.key},"*")},communicateWithIframe:function(e){var data=e.data;switch(data.task){case"setHeight":document.getElementById("mediaFrame").height=data.height+"px";break;case"submit":this.$emit("submit",data.values);break;case"results":document.getElementById("mediaFrame").contentWindow.postMessage(data,"*")}}}},o=(n(1267),n(23)),component=Object(o.a)(r,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"template-wrapper"},[e.loading?n("div",{staticClass:"loading-text subtitle"},[e._v("\n    Loading\n  ")]):e._e(),e._v(" "),n("iframe",{ref:"mediaFrame",attrs:{id:"mediaFrame",src:e.alternativeFrontendUrl+"/template",name:"mediaFrame",sandbox:"allow-scripts allow-modals allow-downloads allow-forms allow-popups allow-pointer-lock allow-same-origin",allow:"geolocation; microphone; camera; autoplay; fullscreen",allowFullScreen:""},on:{load:e.mediaFrameLoaded}})])}),[],!1,null,"502fba47",null);t.a=component.exports},1267:function(e,t,n){"use strict";n(1256)},1268:function(e,t,n){var r=n(57)(!1);r.push([e.i,"@import url(https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap);"]),r.push([e.i,".template-wrapper[data-v-502fba47]{width:100%}#mediaFrame[data-v-502fba47]{width:100%;border:none}",""]),e.exports=r},1278:function(e,t,n){"use strict";var r=n(1292),o=n.n(r),c={name:"InstructionsModal",props:{campaign:{type:Object,required:!0,default:function(){return{}}},info:{type:Object,required:!0,default:function(){return{}}},show:{type:Boolean,required:!1,default:!1},functional:{type:Boolean,required:!1,default:!0},readonly:{type:Boolean,required:!1,default:!1}},data:function(){return{tac:!1}},computed:{showModal:{get:function(){return this.show},set:function(e){this.$emit("clicked",e)}}},methods:{onCancel:function(){this.functional&&(this.showModal=!1)},onClick:function(){this.functional&&this.$parent.joinCampaign()},sanitizeHtmlCustom:function(e){return o()(e,{allowedTags:["h1","h2","h3","h4","h5","h6","blockquote","p","a","ul","ol","nl","li","b","i","strong","em","strike","code","hr","br","div","table","thead","caption","tbody","tr","th","td","pre","iframe","img","span","label"],allowedAttributes:{a:["href","name","target","class"],img:["src","alt"],iframe:["src"],"*":["style"]}})}}},l=n(23),component=Object(l.a)(c,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.campaign&&e.info?n("div",{staticClass:"modal",class:{"is-active":e.showModal},style:{position:e.functional?"fixed":"relative",padding:e.functional?"initial":"10px",zIndex:e.functional?"40":"1"}},[n("div",{staticClass:"modal-background"}),e._v(" "),n("div",{staticClass:"modal-card"},[n("header",{staticClass:"modal-card-head"},[n("p",{staticClass:"modal-card-title"},[e._v("\n        "+e._s(e.info.title)+"\n      ")]),e._v(" "),n("button",{staticClass:"delete",attrs:{"aria-label":"close",disabled:!e.functional},on:{click:function(t){return t.preventDefault(),e.onCancel()}}})]),e._v(" "),n("section",{staticClass:"modal-card-body"},[e.campaign&&e.info?n("div",{staticClass:"content",domProps:{innerHTML:e._s(e.sanitizeHtmlCustom(e.$md.render(e.info.instructions)))}}):n("p",[e._v("\n        ...\n      ")]),e._v(" "),n("label",{staticClass:"checkbox"},[e.readonly?n("input",{attrs:{checked:"",type:"checkbox",disabled:""}}):n("input",{directives:[{name:"model",rawName:"v-model",value:e.tac,expression:"tac"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.tac)?e._i(e.tac,null)>-1:e.tac},on:{change:function(t){var n=e.tac,r=t.target,o=!!r.checked;if(Array.isArray(n)){var c=e._i(n,null);r.checked?c<0&&(e.tac=n.concat([null])):c>-1&&(e.tac=n.slice(0,c).concat(n.slice(c+1)))}else e.tac=o}}}),e._v("\n        I agree to the "),n("a",{attrs:{href:"/download/tac.pdf",target:"_blank"}},[e._v("terms and conditions")])])]),e._v(" "),n("footer",{staticClass:"modal-card-foot"},[e.readonly?n("button",{staticClass:"button is-primary",attrs:{disabled:!e.functional},on:{click:function(t){return t.preventDefault(),e.onCancel()}}},[e._v("\n        OK\n      ")]):[n("button",{staticClass:"button is-primary has-tooltip has-tooltip-arrow",attrs:{"data-tooltip":e.tac?"No additional\nqualifications needed":"agree to the terms and\nconditions to qualify",disabled:!(e.tac&&e.campaign&&e.info&&e.functional)},on:{click:function(t){return t.preventDefault(),e.onClick()}}},[e._v("\n          Qualify\n        ")]),e._v(" "),n("button",{staticClass:"button",attrs:{disabled:!e.functional},on:{click:function(t){return t.preventDefault(),e.onCancel()}}},[e._v("\n          Cancel\n        ")])]],2)])]):e._e()}),[],!1,null,"40d012a4",null);t.a=component.exports},1280:function(e,t){},1281:function(e,t){},1283:function(e,t){},1286:function(e,t){},1300:function(e,t){},1301:function(e,t,n){"use strict";n(79),n(107),n(59),n(108),n(89),n(71),n(93),n(51);var r=n(3),o=n(38),c=(n(33),n(50),n(91),n(25),n(1430),n(94),n(70),n(69),n(608),n(607),n(185),n(88),n(1257),n(183));function l(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return d(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){l=!0,o=e},f:function(){try{c||null==n.return||n.return()}finally{if(l)throw o}}}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function f(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function m(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?f(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):f(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}function h(e){var t,n,r,o=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,r=Symbol.iterator);o--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new v(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function v(s){function e(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return v=function(s){this.s=s,this.n=s.next},v.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(t){var n=this.s.return;return void 0===n?Promise.resolve({value:t,done:!0}):e(n.apply(this.s,arguments))},throw:function(t){var n=this.s.return;return void 0===n?Promise.reject(t):e(n.apply(this.s,arguments))}},new v(s)}var y=n(377),k={props:{batch:{type:Object,default:null},campaignId:{type:Number,default:null}},data:function(){return{loading:!1,error:null,availableBatches:[]}},computed:m(m(m({},Object(c.b)({batchesByCampaignId:"campaign/batchesByCampaignId",submissionsByBatchId:"campaign/submissionsByBatchId"})),Object(c.c)({allSubmissionsLoaded:function(e){return e.campaign.allSubmissionsLoaded}})),{},{campaignBatches:function(){return this.batchesByCampaignId(this.campaignId)}}),mounted:function(){this.makeReservation()},methods:{getSubmissions:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch("campaign/getSubmissions");case 2:case"end":return t.stop()}}),t)})))()},makeReservation:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n,r,o,c,d,f,m,h,v,y,k,w,x,_,I,O,j,C;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n=!1,t.next=4,e.getSubmissions();case 4:if(e.batch)e.availableBatches.push(e.batch);else{r=l(e.campaignBatches);try{for(r.s();!(o=r.n()).done;)(c=o.value).num_tasks*c.repetitions>c.tasks_done&&e.availableBatches.push(c)}catch(e){r.e(e)}finally{r.f()}}d=l(e.availableBatches),t.prev=6,d.s();case 8:if((f=d.n()).done){t.next=63;break}return m=f.value,t.next=12,e.$store.dispatch("campaign/getBatchTasks",m);case 12:return e.loading=!0,t.next=15,e.submissionsByBatchId(m.batch_id);case 15:for(h=t.sent,v=[],y=[],k=0,w=Object.values(h);k<w.length;k++)(x=w[k]).data&&x.data.length?y.push(x):v.push(x);return t.next=21,e.pickReservationForUser(v);case 21:if(!(_=t.sent).reservation){t.next=51;break}if(!_.isExpired){t.next=33;break}return t.next=26,e.$blockchain.claimExpiredTask(_.reservation.id,_.reservation.account_id);case 26:return I=t.sent,e.$store.dispatch("transaction/addTransaction",I),t.next=30,e.findReservation(_,m);case 30:_=t.sent,t.next=49;break;case 33:if(!_.isReleased){t.next=43;break}return t.next=36,e.$blockchain.reclaimTask(_.reservation.id);case 36:return O=t.sent,e.$store.dispatch("transaction/addTransaction",O),t.next=40,e.findReservation(_,m);case 40:_=t.sent,t.next=49;break;case 43:return t.next=45,e.$blockchain.getTaskIndexFromLeaf(m.campaign_id,m.id,_.reservation.leaf_hash,m.tasks);case 45:return j=t.sent,e.$router.push("/campaigns/"+m.campaign_id+"/"+m.batch_id+"/"+j+"?submissionId="+_.reservation.id),n=!0,t.abrupt("break",63);case 49:t.next=54;break;case 51:return t.next=53,e.createNewReservation(m,h,_);case 53:_=t.sent;case 54:if(!_.reservation){t.next=61;break}return n=!0,t.next=58,e.$blockchain.getTaskIndexFromLeaf(m.campaign_id,m.id,_.reservation.leaf_hash,m.tasks);case 58:return C=t.sent,e.$router.push("/campaigns/"+m.campaign_id+"/"+m.batch_id+"/"+C+"?submissionId="+_.reservation.id),t.abrupt("break",63);case 61:t.next=8;break;case 63:t.next=68;break;case 65:t.prev=65,t.t0=t.catch(6),d.e(t.t0);case 68:return t.prev=68,d.f(),t.finish(68);case 71:e.loading=!1,!n&&e.batch?e.$router.push("/campaigns/"+e.batch.campaign_id+"/"+e.batch.batch_id+"?batchCompleted=1"):!n&&e.campaignId&&e.$router.push("/campaigns/"+e.campaignId+"?completed=1"),t.next=80;break;case 75:t.prev=75,t.t1=t.catch(0),e.loading=!1,e.$blockchain.handleError(t.t1),e.$router.push("/campaigns/"+e.campaignId);case 80:case"end":return t.stop()}}),t,null,[[0,75],[6,65,68,71]])})))()},createNewReservation:function(e,t,n){var o=this;return Object(r.a)(regeneratorRuntime.mark((function r(){var c,d,f,m,v,y,k,w,x,sub,_,I,i,O,j,C,$,R;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return d=[],f=[],r.next=4,o.$blockchain.getTreeLeaves(e.campaign_id,e.id,e.tasks);case 4:m=r.sent,v=!1,y=!1,r.prev=7,w=h(t);case 9:return r.next=11,w.next();case 11:if(!(v=!(x=r.sent).done)){r.next=21;break}return sub=x.value,r.next=15,o.$blockchain.getTaskIndexFromLeaf(e.campaign_id,e.id,sub.leaf_hash,e.tasks,m);case 15:_=r.sent,d.push(_),sub.account_id===o.$auth.user.vAccountRows[0].id&&f.push(_);case 18:v=!1,r.next=9;break;case 21:r.next=27;break;case 23:r.prev=23,r.t0=r.catch(7),y=!0,k=r.t0;case 27:if(r.prev=27,r.prev=28,!v||null==w.return){r.next=32;break}return r.next=32,w.return();case 32:if(r.prev=32,!y){r.next=35;break}throw k;case 35:return r.finish(32);case 36:return r.finish(27);case 37:if(d.length>0){for(I={},i=0;i<e.num_tasks;i++)I[i]=0;O=l(d);try{for(O.s();!(j=O.n()).done;)C=j.value,I[C]=I[C]?I[C]+1:1}catch(e){O.e(e)}finally{O.f()}$=Object.keys(I).find((function(t){return I[t]<e.repetitions&&!o.didWorkerDoTask(f,t)})),c=$?parseInt($):null}else c=0;if(null===c){r.next=48;break}return r.next=41,o.$blockchain.reserveTask(e.id,c,e.campaign_id,e.tasks);case 41:return R=r.sent,o.$store.dispatch("transaction/addTransaction",R),r.next=45,o.findReservation(n,e);case 45:return r.abrupt("return",r.sent);case 48:return r.abrupt("return",{reservation:null,isReleased:!1,isExpired:!1});case 49:case"end":return r.stop()}}),r,null,[[7,23,27,37],[28,,32,36]])})))()},didWorkerDoTask:function(e,t){var n=e.find((function(i){return parseInt(i)===parseInt(t)}));return null!=n},pickReservationForUser:function(e){var t,n=null,r=!1,o=!1,c=l(e);try{for(c.s();!(t=c.n()).done;){var d=t.value;if(!d.data||!d.data.length)if(null!==d.account_id&&parseInt(new Date(new Date(d.submitted_on)+"UTC").getTime()/1e3)+parseInt(this.$blockchain.sdk.force.config.releaseTaskDelaySec.toFixed(0))<parseInt((Date.now()/1e3).toFixed(0)))n=d,r=!0;else{if(null===d.account_id){n=d,o=!0;break}if(d.account_id===this.$auth.user.vAccountRows[0].id){n=d,r=!1,o=!1;break}}}}catch(e){c.e(e)}finally{c.f()}return{reservation:n,isReleased:o,isExpired:r}},findReservation:function(e,t){var n=this;return Object(r.a)(regeneratorRuntime.mark((function o(){return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,y(Object(r.a)(regeneratorRuntime.mark((function r(){var o,c,l,d,f;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n.getSubmissions();case 2:return r.next=4,n.submissionsByBatchId(t.batch_id);case 4:for(o=r.sent,c=[],l=0,d=Object.values(o);l<d.length;l++)(f=d[l]).data&&f.data.length||c.push(f);return r.next=9,n.pickReservationForUser(c);case 9:if((e=r.sent).reservation&&!e.isReleased&&!e.isExpired){r.next=14;break}throw new Error("Reservation not found");case 14:return r.abrupt("return",e);case 15:case"end":return r.stop()}}),r)}))),{retries:5,onRetry:function(e,t){console.log("attempt",t,e)}});case 2:return o.abrupt("return",o.sent);case 3:case"end":return o.stop()}}),o)})))()}}},w=n(23),component=Object(w.a)(k,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("span",[e.loading?r("div",{staticClass:"loader-wrapper is-active"},[r("img",{attrs:{src:n(374)}}),e._v(" "),r("br"),r("span",{staticClass:"loading-text"},[e._v("Making reservation")])]):e._e()])}),[],!1,null,null,null);t.a=component.exports},1430:function(e,t,n){n(378)("asyncIterator")}}]);